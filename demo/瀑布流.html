<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .waterfall {
            /* max-width: 600px;
              margin: 0 auto; */
        }
        
        .waterfall img {
            position: absolute;
            width: 100px;
            margin: 10px;
            /* 布局transition效果 */
            transition: all .4s;
        }
    </style>
</head>

<body>
    <div class="waterfall">
        <img src="http://via.placeholder.com/100x100" alt="100*100" style="left: 0px; top: 0px;">
        <img src="http://via.placeholder.com/100x70" alt="100*70" style="left: 120px; top: 0px;">
        <img src="http://via.placeholder.com/100x150" alt="100*150" style="left: 240px; top: 0px;">
        <img src="http://via.placeholder.com/100x250" alt="100*250" style="left: 360px; top: 0px;">
        <img src="http://via.placeholder.com/100x80" alt="100*80" style="left: 480px; top: 0px;">
        <img src="http://via.placeholder.com/100x90" alt="100*90" style="left: 600px; top: 0px;">
        <img src="http://via.placeholder.com/100x120" alt="100*120" style="left: 720px; top: 0px;">
        <img src="http://via.placeholder.com/100x210" alt="100*210" style="left: 840px; top: 0px;">
        <img src="http://via.placeholder.com/100x230" alt="100*230" style="left: 960px; top: 0px;">
        <img src="http://via.placeholder.com/100x100" alt="100*100" style="left: 1080px; top: 0px;">
        <img src="http://via.placeholder.com/100x70" alt="100*70" style="left: 120px; top: 90px;">
        <img src="http://via.placeholder.com/100x150" alt="100*150" style="left: 480px; top: 100px;">
        <img src="http://via.placeholder.com/100x250" alt="100*250" style="left: 600px; top: 110px;">
        <img src="http://via.placeholder.com/100x80" alt="100*80" style="left: 0px; top: 120px;">
        <img src="http://via.placeholder.com/100x90" alt="100*90" style="left: 1080px; top: 120px;">
        <img src="http://via.placeholder.com/100x120" alt="100*120" style="left: 720px; top: 140px;">
        <img src="http://via.placeholder.com/100x210" alt="100*210" style="left: 240px; top: 170px;">
        <img src="http://via.placeholder.com/100x250" alt="100*250" style="left: 120px; top: 180px;">
        <img src="http://via.placeholder.com/100x80" alt="100*80" style="left: 0px; top: 220px;">
        <img src="http://via.placeholder.com/100x80" alt="100*80" style="left: 840px; top: 230px;">
        <img src="http://via.placeholder.com/100x90" alt="100*90" style="left: 1080px; top: 230px;">
        <img src="http://via.placeholder.com/100x120" alt="100*120" style="left: 960px; top: 250px;">
        <img src="http://via.placeholder.com/100x210" alt="100*210" style="left: 360px; top: 270px;">
        <img src="http://via.placeholder.com/100x100" alt="100*100" style="left: 480px; top: 270px;">
        <img src="http://via.placeholder.com/100x70" alt="100*70" style="left: 720px; top: 280px;">
        <img src="http://via.placeholder.com/100x250" alt="100*250" style="left: 0px; top: 320px;">
        <img src="http://via.placeholder.com/100x210" alt="100*210" style="left: 840px; top: 330px;">
        <img src="http://via.placeholder.com/100x250" alt="100*250" style="left: 1080px; top: 340px;">
        <img src="http://via.placeholder.com/100x210" alt="100*210" style="left: 720px; top: 370px;">
        <img src="http://via.placeholder.com/100x230" alt="100*230" style="left: 600px; top: 380px;">
        <img src="http://via.placeholder.com/100x100" alt="100*100" style="left: 480px; top: 390px;">
        <img src="http://via.placeholder.com/100x70" alt="100*70" style="left: 960px; top: 390px;">
        <img src="http://via.placeholder.com/100x150" alt="100*150" style="left: 240px; top: 400px;">
        <img src="http://via.placeholder.com/100x150" alt="100*150" style="left: 120px; top: 450px;">
        <img src="http://via.placeholder.com/100x230" alt="100*230" style="left: 960px; top: 480px;">
        <img src="http://via.placeholder.com/100x70" alt="100*70" style="left: 360px; top: 500px;">
        <img src="http://via.placeholder.com/100x150" alt="100*150" style="left: 480px; top: 510px;">
        <img src="http://via.placeholder.com/100x250" alt="100*250" style="left: 840px; top: 560px;">
        <img src="http://via.placeholder.com/100x80" alt="100*80" style="left: 240px; top: 570px;">
        <img src="http://via.placeholder.com/100x90" alt="100*90" style="left: 0px; top: 590px;">
        <img src="http://via.placeholder.com/100x120" alt="100*120" style="left: 360px; top: 590px;">
        <img src="http://via.placeholder.com/100x210" alt="100*210" style="left: 720px; top: 600px;">
        <img src="http://via.placeholder.com/100x250" alt="100*250" style="left: 1080px; top: 610px;">
        <img src="http://via.placeholder.com/100x80" alt="100*80" style="left: 120px; top: 620px;">
        <img src="http://via.placeholder.com/100x80" alt="100*80" style="left: 600px; top: 630px;">
        <img src="http://via.placeholder.com/100x90" alt="100*90" style="left: 240px; top: 670px;">
        <img src="http://via.placeholder.com/100x120" alt="100*120" style="left: 480px; top: 680px;">
        <img src="http://via.placeholder.com/100x210" alt="100*210" style="left: 0px; top: 700px;">
    </div>
    <script>
        window.onload = function() {
            let colCount // 定义列数
            let colHeightArr = [] // 定义列高数组
            const imgNode = document.querySelector('.waterfall img')
            const imgWidth = imgNode.offsetWidth + parseInt(getComputedStyle(imgNode).marginLeft) + parseInt(getComputedStyle(imgNode).marginRight) // 获取单张图片的宽度

            function reset() {
                colCount = Math.floor(document.body.offsetWidth / imgWidth)
                colHeightArr = []
                for (let i = 0; i < colCount; i++) {
                    // 初始化高度数组
                    colHeightArr[i] = 0
                }

                const imgNodes = document.querySelectorAll('.waterfall img')
                for (let index = 0; index < imgNodes.length; index++) {
                    // imgNodes[index].addEventListener('load', function() {
                    //     let minValue = colHeightArr[0] // 定义最小的高度
                    //     let minIndex = 0 // 定义最小高度的下标
                    //     for (let i = 0; i < colHeightArr; i++) {
                    //         if (colHeightArr[i] < minValue) {
                    //             minValue = colHeightArr[i]
                    //             minIndex = i
                    //         }
                    //     }
                    //     this.style.left = minIndex * imgWidth
                    //     this.style.top = minValue
                    //     colHeightArr[minValue] += this.offsetHeight
                    // })
                    let minValue = colHeightArr[0] // 定义最小的高度
                    let minIndex = 0 // 定义最小高度的下标
                    for (let i = 0; i < colHeightArr.length; i++) {
                        if (colHeightArr[i] < minValue) {
                            minValue = colHeightArr[i]
                            minIndex = i
                        }
                    }
                    imgNodes[index].style.left = minIndex * imgWidth + 'px'
                    imgNodes[index].style.top = minValue + 'px'
                    colHeightArr[minIndex] += imgNodes[index].offsetHeight + parseInt(getComputedStyle(imgNode).marginLeft) + parseInt(getComputedStyle(imgNode).marginRight)
                }
            }

            reset()
            window.onresize = function() {
                reset()
            }
        }
    </script>
</body>

</html>